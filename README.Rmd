---
title: "README"
author: "Ryan^3 + John"
date: "2024-03-29"
output: html_document
---

Group Name: **Ryan\^3 + John**

Group Members:

-   **Ryan Ledbetter**
-   **Ryan Riebesehl**
-   **Ryan Rockey**
-   **John Nesnidal**

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## English Premier League Statistics

Our data encompasses the last 22 years of the English Premier League, the largest soccer league in the world, by revenue. This includes statistics about every game, including goals scored, shots taken, the teams involved, even betting odds for many of the games.

```{r}
##prem <- read.csv(file.choose(), header = T)
prem <- read.csv("Datasets/final_dataset.csv")

head(prem, 3)
```

```{r}
##Missing Values:
missing_values <- colSums(is.na(prem))
print(missing_values)
```

```{r}
##Date-time Format:
prem$Date <- as.Date(prem$Date, format = "%d/%m/%y")

##Unique Values:
unique_teams <- unique(c(prem$HomeTeam, prem$AwayTeam))
print(unique_teams)

## Possible Unnecessay Columns:
columns_to_remove <- c("Div", "Time", "Referee") 
prem_clean <- prem[, !(names(prem) %in% columns_to_remove)]
```

## **Marginal Summaries:**

```{r}
##Summary Statistics:
summary(prem_clean)
```

```{r}
##Table of full time results:
outcome_freq <- table(prem_clean$FTR)
print(outcome_freq)
```

### Questions to be answered:

#### General Trends over time:

-   How has scoring changed over the years?
-   How does scoring change across a full season?
-   Is there a significant home advantage in the English Premier League over the past 22 years?

#### Home vs. Away performance: Ryan L

-   How do teams tend to perform in home games vs. away games?
-   Is there a measurable advantage to being at home?

#### Goal scoring analysis:

-   Which teams have scored the most/fewest goals?
-   Does having a greater % of shots on target correlate to winning more?
-   Is there a correlation between the number of shots taken by a team and the number of goals scored?

#### Betting trends:

-   How well do the betting odds predict the outcome of a game?
-   Is there a correlation between pre-match betting odds and match outcomes?

#### Predictive analysis:

-   Can we use the previous data to predict the outcome of the rest of the current premier league season?
-   How has the overall style of play (e.g., possession, based, counter-attacking) evolved over this 22-year period?

------------------------------------------------------------------------

#### [General Trends over time:]{.underline}

(1). How has Scoring Changed Over Time?

```{r}
library(dplyr)  
library(ggplot2)
library(tidyverse)

#Add column for season (year):
prem_clean <- prem_clean %>%
  mutate(Season = format(Date, "%Y"))

#Average goals per game for each season:
avg_goals_per_season <- prem_clean %>%
  group_by(Season) %>%
  summarize(
    avg_goals = mean(FTHG + FTAG)  #(home goals + away goals)
  )

# Line Graph of the average goals per season:
ggplot(avg_goals_per_season, aes(x = Season, y = avg_goals, group = 1)) +
  geom_line() +
  labs(title = "Average Goals Per Game Over the Years",
       x = "Season (Year)",
       y = "Average Goals Per Game") +
  theme_minimal()

```

\*Based on our line graph, the average goals per game were lower near the older years (2000-2009). While the average goals per game were higher in the more recent years (2010-2020). One reason why the average goals are increasing over the years could be due to multiple thrashings occurring between some teams and the rest of the league. Another reason could be that Premier League fans like a high goals-per-game ratio. Or from a strategic standpoint, there is a lack of defensive organisation.

\*[Resource]{.underline}:<https://theathletic.com/5292045/2024/02/24/why-so-many-goals-premier-league/>

\-

(2). How does scoring change across a full season?

```{r}
#Column for matchday:
prem_clean <- prem_clean %>%
  mutate(Matchday = as.integer(format(Date, "%j")) %/% 7 + 1)

#Average goals per game for each matchday:
avg_goals_per_matchday <- prem_clean %>%
  group_by(Matchday) %>%
  summarize(
    avg_goals = mean(FTHG + FTAG)  #(home goals + away goals)
  )

#Line graph of average goals per matchday:
ggplot(avg_goals_per_matchday, aes(x = Matchday, y = avg_goals, group = 1)) +
  geom_line() +
  labs(title = "Average Goals Per Game Across the Season",
       x = "Matchday",
       y = "Average Goals Per Game") +
  theme_minimal()

```

\*Based on our line graph, the average goals as the season progresses is the lowest at the start of the season an at the end of the season. Where the average goals is the highest at the mid-point of the season. This could be due to Premier League teams having the intensity of needing a reputation to intimidate other player in light of the championship playoffs at the end of the season.

\*[Resource]{.underline}:<https://theanalyst.com/na/2023/12/goals-galore-how-the-premier-league-is-producing-more-goals-than-ever-before/>

\-

(3). Is there a significant home advantage in the English Premier League over the past 22 years?

```{r}
#Precentages of home wins and away wins:
home_advantage <- prem_clean %>%
  group_by(Season) %>%
  summarize(
    home_win_percentage = mean(FTR == "H") * 100,
    away_win_percentage = mean(FTR == "NH") * 100,
  )
print(home_advantage)

#Chi-Square Test of Independe (Are these variables ralted?):
contingency_table <- table(prem_clean$FTR)
chi_square_test <- chisq.test(contingency_table)

print(chi_square_test)

#T-test compaing average goals scored by home and away teams (Is there a difference in the means between the variables?):
t_test <- t.test(prem_clean$FTHG, prem_clean$FTAG)

print(t_test)

#Line Graph Comparing home and away precentages over the years:
ggplot(home_advantage, aes(x = Season)) +
  geom_line(aes(y = home_win_percentage, color = "Home Wins", group = 1)) +
  geom_line(aes(y = away_win_percentage, color = "Away Wins", group = 2)) +
  labs(title = "Home/Away Advantage in the EPL Over the Past 22 Years",
       x = "Season (Year)",
       y = "Percentage") +
  scale_color_manual(values = c("Home Wins" = "blue", "Away Wins" = "red")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

\*Based on our line graph and percentages calculated, the win percentages tended to be higher for teams when they were away versus being on their home field. Additionally, according to our ran Chi-squared test and t-test, there is very strong evidence that the home and away variables are related to each other and their is a significant difference between them. While this quite a surprising result, some factors that could have contributed to this result could be due to a new environment (field) for the away players, the absence of fans during bad weather, or even that many people are watching the broadcasts of the games with their technological devices.

\*[Resource]{.underline}: <https://www.skysports.com/football/news/11661/12079338/premier-league-goals-and-away-wins-at-record-highs-has-home-advantage-been-wiped-out>

------------------------------------------------------------------------

#### [Home vs. Away performance]{.underline}:
```{r}
data1 <- read.csv("Datasets/2000-01.csv")
data2 <- read.csv("Datasets/2001-02.csv")
data3 <- read.csv("Datasets/2002-03.csv")
data4 <- read.csv("Datasets/2003-04.csv")
data5 <- read.csv("Datasets/2004-05.csv")
data6 <- read.csv("Datasets/2005-06.csv")
data7 <- read.csv("Datasets/2006-07.csv")
data8 <- read.csv("Datasets/2007-08.csv")
data9 <- read.csv("Datasets/2008-09.csv")
data10 <- read.csv("Datasets/2009-10.csv")
data11 <- read.csv("Datasets/2010-11.csv")
data12 <- read.csv("Datasets/2011-12.csv")
data13 <- read.csv("Datasets/2012-13.csv")
data14 <- read.csv("Datasets/2013-14.csv")
data15 <- read.csv("Datasets/2014-15.csv")
data16 <- read.csv("Datasets/2015-16.csv")
data17 <- read.csv("Datasets/2016-17.csv")
data18 <- read.csv("Datasets/2017-18.csv")
data19 <- read.csv("Datasets/2018-19.csv")
data20 <- read.csv("Datasets/2019-20.csv")
data21 <- read.csv("Datasets/2020-2021.csv")
data22 <- read.csv("Datasets/2021-2022.csv")

merged <- cbind(data1, data2, data3, data4, data5, data6, data7, data8, data9, data10, data11, data12, data13, data14, data15, data16, data17, data18, data19, data20, data21, data22)
```

(1) How do teams tend to perform in home games vs. away games?
```{r}

```

(2) Is there a measurable advantage to being at home?
```{r}

```
(3) Are teams more likely to get carded when away?
```{r}
# Calculate total cards for home and away teams
epl_cards <- prem_clean %>%
  mutate(total_yellow_home = yellow_cards_home + red_cards_home,
         total_yellow_away = yellow_cards_away + red_cards_away)

# Summarize total cards for each team
home_cards <- epl_data %>%
  group_by(home_team) %>%
  summarise(total_yellow = sum(total_yellow_home),
            total_red = sum(red_cards_home))

away_cards <- epl_data %>%
  group_by(away_team) %>%
  summarise(total_yellow = sum(total_yellow_away),
            total_red = sum(red_cards_away))

# Merge home and away cards
all_cards <- merge(home_cards, away_cards, by.x = "home_team", by.y = "away_team", all = TRUE)
all_cards$total_yellow <- rowSums(subset(all_cards, select=c(total_yellow.x, total_yellow.y)), na.rm=TRUE)
all_cards$total_red <- rowSums(subset(all_cards, select=c(total_red.x, total_red.y)), na.rm=TRUE)
all_cards <- subset(all_cards, select=c(home_team, total_yellow, total_red))

# Reshape data for plotting
cards_melted <- melt(all_cards, id.vars = "home_team")

# Create stacked bar graph
ggplot(cards_melted, aes(x = home_team, y = value, fill = variable)) +
  geom_bar(stat = "identity") +
  labs(title = "Total Yellow and Red Cards by Team (Last 20 Years)",
       x = "Team",
       y = "Total Cards") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

#### [Goal Scoring Analysis]{.underline}:

-   Which teams have scored the most/fewest goals?

```{r}
View(prem)
```

-   Does having a greater % of shots on target correlate to winning more?

```{r}

```

-   Is there a correlation between the number of shots taken by a team and the number of goals scored?

```{r}

```
